---
// ScrollReveal â€” Intersection Observer fade-in
// Applied to chapter content. Prose gets opacity-only, landmarks get opacity + translateY.
// Uses astro:page-load for View Transition compatibility.
---

<script>
  function initScrollReveal() {
    const content = document.querySelector('.chapter-content');
    if (!content) return;

    // Check reduced motion preference
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    // Select elements to animate
    const proseElements = content.querySelectorAll(':scope > p, :scope > ul, :scope > ol');
    const landmarkElements = content.querySelectorAll(':scope > h2, :scope > h3, :scope > blockquote, :scope > figure, :scope > .radar-figure, :scope > .comparison-figure');

    // Apply initial hidden state
    proseElements.forEach(el => {
      (el as HTMLElement).style.opacity = '0';
      (el as HTMLElement).style.transition = 'opacity 0.8s ease';
    });

    landmarkElements.forEach(el => {
      (el as HTMLElement).style.opacity = '0';
      (el as HTMLElement).style.transform = 'translateY(12px)';
      (el as HTMLElement).style.transition = 'opacity 0.7s ease, transform 0.7s ease';
    });

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            (entry.target as HTMLElement).style.opacity = '1';
            (entry.target as HTMLElement).style.transform = 'translateY(0)';
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -40px 0px' }
    );

    proseElements.forEach(el => observer.observe(el));
    landmarkElements.forEach(el => observer.observe(el));
  }

  document.addEventListener('astro:page-load', initScrollReveal);
</script>
